Bootstrap: docker
From: ubuntu:18.04

%post
        apt-get -y update
        apt-get -y install build-essential gcc g++ vim wget libatlas-base-dev gfortran openssh-server

        wget https://download.open-mpi.org/release/open-mpi/v4.0/openmpi-4.0.0.tar.gz
        tar -xvf openmpi-*
        cd openmpi*
        ./configure --prefix="/home/$USER/.openmpi"
        make
        make install
        export PATH="$PATH:/home/$USER/.openmpi/bin"
        export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/home/$USER/.openmpi/lib/"

        wget http://www.netlib.org/benchmark/hpl/hpl-2.3.tar.gz -P /
        cd /
        tar xf /hpl-2.3.tar.gz
        wget https://raw.githubusercontent.com/MohammedGhawanni/singularity_hpl_files/master/HPL.dat -P /
        wget https://raw.githubusercontent.com/MohammedGhawanni/singularity_hpl_files/master/Make.ubuntu -P /
        mv /hpl-2.3 /hpl
        mv /Make.ubuntu /hpl
        cd /hpl && make arch=ubuntu
        mv /HPL.dat /hpl/bin/ubuntu/HPL.dat

%environment

%startscript
        #mpirun -np 64 --allow-run-as-root /hpl/bin/ubuntu/xhpl
