Bootstrap: docker
From: ubuntu:18.04

%post
        apt-get -y update
        apt-get -y install build-essential vim
        apt install -y libopenmpi-dev=2.1.1-8
        apt install -y openssh-server
        apt-get install -y libatlas-base-dev gfortran
        wget http://www.netlib.org/benchmark/hpl/hpl-2.3.tar.gz -P /
        tar xf hpl-2.3.tar.gz
        wget https://raw.githubusercontent.com/MohammedGhawanni/singularity_hpl_files/master/HPL.dat -P /
        wget https://raw.githubusercontent.com/MohammedGhawanni/singularity_hpl_files/master/Make.ubuntu -P /
        mv /hpl-2.3 /hpl
        mv /Make.ubuntu /hpl
        cd /hpl && make arch=ubuntu
        mv /HPL.dat /hpl/bin/ubuntu/HPL.dat

%startscript
        mpirun -np 64 --allow-run-as-root /hpl/bin/ubuntu/xhpl
